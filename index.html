<!doctype html>
<html lang="en">
  <head>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/speech-commands@0.4.0/dist/speech-commands.min.js"></script>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Artifact Viewer</title>
      <script type="module" crossorigin src="/memory-fys-game/assets/index-DAfyNKcu.js"></script>
      <link rel="stylesheet" crossorigin href="/memory-fys-game/assets/index-C099JD6y.css">
    </head>
  <body>
    <!-- Teachable Machine Section -->
    <div style="padding: 20px; border-bottom: 1px solid #ccc; margin-bottom: 20px;">
      <div>Teachable Machine Audio Model</div>
      <button type="button" class="btn btn-primary" onclick="init()">Start</button>
      <div class="form-group"></div>
        <label for="model-url">Teachable machine model URL:</label>
        <input type="text" class="form-control" id="model-url" value="https://teachablemachine.withgoogle.com/models/rnDxAsp_L/" placeholder="Enter model URL">
      </div>
      <div id="label-container"></div>
      <script type="text/javascript">
          async function createModel() {
              const URL = document.getElementById("model-url").value;
              // Add a trailing slash to the URL if it doesn't exist
              if (!URL.endsWith("/")) {
                  URL = URL + "/";
              }
              const checkpointURL = URL + "model.json"; // model topology
              const metadataURL = URL + "metadata.json"; // model metadata
              const recognizer = speechCommands.create(
                  "BROWSER_FFT",
                  undefined,
                  checkpointURL,
                  metadataURL);
              await recognizer.ensureModelLoaded();
              return recognizer;
          }
          async function init() {
              const recognizer = await createModel();
              const classLabels = recognizer.wordLabels();
              const labelContainer = document.getElementById("label-container");
              for (let i = 0; i < classLabels.length; i++) {
                  labelContainer.appendChild(document.createElement("div"));
              }
              recognizer.listen(result => {
                  const scores = result.scores;
                  for (let i = 0; i < classLabels.length; i++) {
                      const classPrediction = classLabels[i] + ": " + result.scores[i].toFixed(2);
                      labelContainer.childNodes[i].innerHTML = classPrediction;
                  }
              }, {
                  includeSpectrogram: true,
                  probabilityThreshold: 0.75,
                  invokeCallbackOnNoiseAndUnknown: true,
                  overlapFactor: 0.50
              });
          }
      </script>
  </div>
    <div id="root"></div>
  </body>
</html>
